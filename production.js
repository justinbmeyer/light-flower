import*as e from"https://unpkg.com/three@0.158.0/build/three.module.js";import{TrianglesDrawMode as t,TriangleFanDrawMode as n,TriangleStripDrawMode as s,Quaternion as r,Matrix4 as o,Loader as i,LoaderUtils as a,FileLoader as c,Color as l,LinearSRGBColorSpace as u,SpotLight as h,PointLight as d,DirectionalLight as p,MeshBasicMaterial as m,SRGBColorSpace as f,MeshPhysicalMaterial as g,Vector2 as A,Vector3 as T,InstancedMesh as w,InstancedBufferAttribute as x,Object3D as R,TextureLoader as E,ImageBitmapLoader as v,BufferAttribute as y,InterleavedBuffer as _,InterleavedBufferAttribute as M,LinearFilter as L,LinearMipmapLinearFilter as S,RepeatWrapping as b,PointsMaterial as I,Material as O,LineBasicMaterial as N,MeshStandardMaterial as H,DoubleSide as C,PropertyBinding as P,BufferGeometry as k,SkinnedMesh as D,Mesh as F,LineSegments as U,Line as G,LineLoop as B,Points as j,Group as V,PerspectiveCamera as K,MathUtils as X,OrthographicCamera as z,Skeleton as q,AnimationClip as W,Bone as Y,InterpolateLinear as Q,ColorManagement as Z,NearestFilter as $,NearestMipmapNearestFilter as J,LinearMipmapNearestFilter as ee,NearestMipmapLinearFilter as te,ClampToEdgeWrapping as ne,MirroredRepeatWrapping as se,InterpolateDiscrete as re,FrontSide as oe,Texture as ie,VectorKeyframeTrack as ae,NumberKeyframeTrack as ce,QuaternionKeyframeTrack as le,Box3 as ue,Sphere as he,Interpolant as de,Ray as pe,Plane as me,Raycaster as fe}from"https://unpkg.com/three@0.158.0/build/three.module.js";function ge(e,r){if(r===t)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(r===n||r===s){let t=e.getIndex();if(null===t){const n=[],s=e.getAttribute("position");if(void 0===s)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<s.count;e++)n.push(e);e.setIndex(n),t=e.getIndex()}const s=t.count-2,o=[];if(r===n)for(let e=1;e<=s;e++)o.push(t.getX(0)),o.push(t.getX(e)),o.push(t.getX(e+1));else for(let e=0;e<s;e++)e%2==0?(o.push(t.getX(e)),o.push(t.getX(e+1)),o.push(t.getX(e+2))):(o.push(t.getX(e+2)),o.push(t.getX(e+1)),o.push(t.getX(e)));o.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=e.clone();return i.setIndex(o),i.clearGroups(),i}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",r),e}class Ae extends i{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new ve(e)})),this.register((function(e){return new Oe(e)})),this.register((function(e){return new Ne(e)})),this.register((function(e){return new He(e)})),this.register((function(e){return new _e(e)})),this.register((function(e){return new Me(e)})),this.register((function(e){return new Le(e)})),this.register((function(e){return new Se(e)})),this.register((function(e){return new Ee(e)})),this.register((function(e){return new be(e)})),this.register((function(e){return new ye(e)})),this.register((function(e){return new Ie(e)})),this.register((function(e){return new xe(e)})),this.register((function(e){return new Ce(e)})),this.register((function(e){return new Pe(e)}))}load(e,t,n,s){const r=this;let o;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:a.extractUrlBase(e),this.manager.itemStart(e);const i=function(t){s?s(t):console.error(t),r.manager.itemError(e),r.manager.itemEnd(e)},l=new c(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,(function(n){try{r.parse(n,o,(function(n){t(n),r.manager.itemEnd(e)}),i)}catch(e){i(e)}}),n,i)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,s){let r;const o={},i={},a=new TextDecoder;if("string"==typeof e)r=JSON.parse(e);else if(e instanceof ArrayBuffer){if(a.decode(new Uint8Array(e,0,4))===ke){try{o[we.KHR_BINARY_GLTF]=new Ue(e)}catch(e){return void(s&&s(e))}r=JSON.parse(o[we.KHR_BINARY_GLTF].content)}else r=JSON.parse(a.decode(e))}else r=e;if(void 0===r.asset||r.asset.version[0]<2)return void(s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const c=new ut(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](c);t.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),i[t.name]=t,o[t.name]=!0}if(r.extensionsUsed)for(let e=0;e<r.extensionsUsed.length;++e){const t=r.extensionsUsed[e],n=r.extensionsRequired||[];switch(t){case we.KHR_MATERIALS_UNLIT:o[t]=new Re;break;case we.KHR_DRACO_MESH_COMPRESSION:o[t]=new Ge(r,this.dracoLoader);break;case we.KHR_TEXTURE_TRANSFORM:o[t]=new Be;break;case we.KHR_MESH_QUANTIZATION:o[t]=new je;break;default:n.indexOf(t)>=0&&void 0===i[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}c.setExtensions(o),c.setPlugins(i),c.parse(n,s)}parseAsync(e,t){const n=this;return new Promise((function(s,r){n.parse(e,t,s,r)}))}}function Te(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const we={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class xe{constructor(e){this.parser=e,this.name=we.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,s=t.length;n<s;n++){const s=t[n];s.extensions&&s.extensions[this.name]&&void 0!==s.extensions[this.name].light&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let s=t.cache.get(n);if(s)return s;const r=t.json,o=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let i;const a=new l(16777215);void 0!==o.color&&a.setRGB(o.color[0],o.color[1],o.color[2],u);const c=void 0!==o.range?o.range:0;switch(o.type){case"directional":i=new p(a),i.target.position.set(0,0,-1),i.add(i.target);break;case"point":i=new d(a),i.distance=c;break;case"spot":i=new h(a),i.distance=c,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,i.angle=o.spot.outerConeAngle,i.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return i.position.set(0,0,0),i.decay=2,rt(i,o),void 0!==o.intensity&&(i.intensity=o.intensity),i.name=t.createUniqueName(o.name||"light_"+e),s=Promise.resolve(i),t.cache.add(n,s),s}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,s=n.json.nodes[e],r=(s.extensions&&s.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then((function(e){return n._getNodeRef(t.cache,r,e)}))}}class Re{constructor(){this.name=we.KHR_MATERIALS_UNLIT}getMaterialType(){return m}extendParams(e,t,n){const s=[];e.color=new l(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const t=r.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],u),e.opacity=t[3]}void 0!==r.baseColorTexture&&s.push(n.assignTexture(e,"map",r.baseColorTexture,f))}return Promise.all(s)}}class Ee{constructor(e){this.parser=e,this.name=we.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name].emissiveStrength;return void 0!==s&&(t.emissiveIntensity=s),Promise.resolve()}}class ve{constructor(e){this.parser=e,this.name=we.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?g:null}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&r.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(r.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const e=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new A(e,e)}return Promise.all(r)}}class ye{constructor(e){this.parser=e,this.name=we.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?g:null}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return void 0!==o.iridescenceFactor&&(t.iridescence=o.iridescenceFactor),void 0!==o.iridescenceTexture&&r.push(n.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),void 0!==o.iridescenceIor&&(t.iridescenceIOR=o.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==o.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),void 0!==o.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),void 0!==o.iridescenceThicknessTexture&&r.push(n.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}}class _e{constructor(e){this.parser=e,this.name=we.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?g:null}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new l(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=s.extensions[this.name];if(void 0!==o.sheenColorFactor){const e=o.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],u)}return void 0!==o.sheenRoughnessFactor&&(t.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&r.push(n.assignTexture(t,"sheenColorMap",o.sheenColorTexture,f)),void 0!==o.sheenRoughnessTexture&&r.push(n.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}}class Me{constructor(e){this.parser=e,this.name=we.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?g:null}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return void 0!==o.transmissionFactor&&(t.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&r.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(r)}}class Le{constructor(e){this.parser=e,this.name=we.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?g:null}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];t.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&r.push(n.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const i=o.attenuationColor||[1,1,1];return t.attenuationColor=(new l).setRGB(i[0],i[1],i[2],u),Promise.all(r)}}class Se{constructor(e){this.parser=e,this.name=we.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?g:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name];return t.ior=void 0!==s.ior?s.ior:1.5,Promise.resolve()}}class be{constructor(e){this.parser=e,this.name=we.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?g:null}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];t.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&r.push(n.assignTexture(t,"specularIntensityMap",o.specularTexture));const i=o.specularColorFactor||[1,1,1];return t.specularColor=(new l).setRGB(i[0],i[1],i[2],u),void 0!==o.specularColorTexture&&r.push(n.assignTexture(t,"specularColorMap",o.specularColorTexture,f)),Promise.all(r)}}class Ie{constructor(e){this.parser=e,this.name=we.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?g:null}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return void 0!==o.anisotropyStrength&&(t.anisotropy=o.anisotropyStrength),void 0!==o.anisotropyRotation&&(t.anisotropyRotation=o.anisotropyRotation),void 0!==o.anisotropyTexture&&r.push(n.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(r)}}class Oe{constructor(e){this.parser=e,this.name=we.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,s=n.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const r=s.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,o)}}class Ne{constructor(e){this.parser=e,this.name=we.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],i=s.images[o.source];let a=n.textureLoader;if(i.uri){const e=n.options.manager.getHandler(i.uri);null!==e&&(a=e)}return this.detectSupport().then((function(r){if(r)return n.loadTextureImage(e,o.source,a);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class He{constructor(e){this.parser=e,this.name=we.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],i=s.images[o.source];let a=n.textureLoader;if(i.uri){const e=n.options.manager.getHandler(i.uri);null!==e&&(a=e)}return this.detectSupport().then((function(r){if(r)return n.loadTextureImage(e,o.source,a);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class Ce{constructor(e){this.name=we.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],s=this.parser.getDependency("buffer",e.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then((function(t){const n=e.byteOffset||0,s=e.byteLength||0,o=e.count,i=e.byteStride,a=new Uint8Array(t,n,s);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(o,i,a,e.mode,e.filter).then((function(e){return e.buffer})):r.ready.then((function(){const t=new ArrayBuffer(o*i);return r.decodeGltfBuffer(new Uint8Array(t),o,i,a,e.mode,e.filter),t}))}))}return null}}class Pe{constructor(e){this.name=we.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;const s=t.meshes[n.mesh];for(const e of s.primitives)if(e.mode!==ze.TRIANGLES&&e.mode!==ze.TRIANGLE_STRIP&&e.mode!==ze.TRIANGLE_FAN&&void 0!==e.mode)return null;const i=n.extensions[this.name].attributes,a=[],c={};for(const e in i)a.push(this.parser.getDependency("accessor",i[e]).then((t=>(c[e]=t,c[e]))));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then((e=>{const t=e.pop(),n=t.isGroup?t.children:[t],s=e[0].count,i=[];for(const e of n){const t=new o,n=new T,a=new r,l=new T(1,1,1),u=new w(e.geometry,e.material,s);for(let e=0;e<s;e++)c.TRANSLATION&&n.fromBufferAttribute(c.TRANSLATION,e),c.ROTATION&&a.fromBufferAttribute(c.ROTATION,e),c.SCALE&&l.fromBufferAttribute(c.SCALE,e),u.setMatrixAt(e,t.compose(n,a,l));for(const t in c)if("_COLOR_0"===t){const e=c[t];u.instanceColor=new x(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,c[t]);R.prototype.copy.call(u,e),this.parser.assignFinalMaterial(u),i.push(u)}return t.isGroup?(t.clear(),t.add(...i),t):i[0]})))}}const ke="glTF",De=1313821514,Fe=5130562;class Ue{constructor(e){this.name=we.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==ke)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-12,r=new DataView(e,12);let o=0;for(;o<s;){const t=r.getUint32(o,!0);o+=4;const s=r.getUint32(o,!0);if(o+=4,s===De){const s=new Uint8Array(e,12+o,t);this.content=n.decode(s)}else if(s===Fe){const n=12+o;this.body=e.slice(n,n+t)}o+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ge{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=we.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,s=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,i={},a={},c={};for(const e in o){const t=Ze[e]||e.toLowerCase();i[t]=o[e]}for(const t in e.attributes){const s=Ze[t]||t.toLowerCase();if(void 0!==o[t]){const r=n.accessors[e.attributes[t]],o=qe[r.componentType];c[s]=o.name,a[s]=!0===r.normalized}}return t.getDependency("bufferView",r).then((function(e){return new Promise((function(t){s.decodeDracoFile(e,(function(e){for(const t in e.attributes){const n=e.attributes[t],s=a[t];void 0!==s&&(n.normalized=s)}t(e)}),i,c)}))}))}}class Be{constructor(){this.name=we.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class je{constructor(){this.name=we.KHR_MESH_QUANTIZATION}}class Ve extends de{constructor(e,t,n,s){super(e,t,n,s)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,r=e*s*3+s;for(let e=0;e!==s;e++)t[e]=n[r+e];return t}interpolate_(e,t,n,s){const r=this.resultBuffer,o=this.sampleValues,i=this.valueSize,a=2*i,c=3*i,l=s-t,u=(n-t)/l,h=u*u,d=h*u,p=e*c,m=p-c,f=-2*d+3*h,g=d-h,A=1-f,T=g-h+u;for(let e=0;e!==i;e++){const t=o[m+e+i],n=o[m+e+a]*l,s=o[p+e+i],c=o[p+e]*l;r[e]=A*t+T*n+f*s+g*c}return r}}const Ke=new r;class Xe extends Ve{interpolate_(e,t,n,s){const r=super.interpolate_(e,t,n,s);return Ke.fromArray(r).normalize().toArray(r),r}}const ze={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},qe={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},We={9728:$,9729:L,9984:J,9985:ee,9986:te,9987:S},Ye={33071:ne,33648:se,10497:b},Qe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ze={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},$e={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Je={CUBICSPLINE:void 0,LINEAR:Q,STEP:re},et="OPAQUE",tt="MASK",nt="BLEND";function st(e,t,n){for(const s in n.extensions)void 0===e[s]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[s]=n.extensions[s])}function rt(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function ot(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,s=t.weights.length;n<s;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,s=n.length;t<s;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function it(e){let t;const n=e.extensions&&e.extensions[we.KHR_DRACO_MESH_COMPRESSION];if(t=n?"draco:"+n.bufferView+":"+n.indices+":"+at(n.attributes):e.indices+":"+at(e.attributes)+":"+e.mode,void 0!==e.targets)for(let n=0,s=e.targets.length;n<s;n++)t+=":"+at(e.targets[n]);return t}function at(e){let t="";const n=Object.keys(e).sort();for(let s=0,r=n.length;s<r;s++)t+=n[s]+":"+e[n[s]]+";";return t}function ct(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const lt=new o;class ut{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Te,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,s=!1,r=-1;"undefined"!=typeof navigator&&(n=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),s=navigator.userAgent.indexOf("Firefox")>-1,r=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||n||s&&r<98?this.textureLoader=new E(this.options.manager):this.textureLoader=new v(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new c(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,s=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){const o={scene:t[0][s.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:s.asset,parser:n,userData:{}};return st(r,o,s),rt(o,s),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(o)}))).then((function(){e(o)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let n=0,s=t.length;n<s;n++){const s=t[n].joints;for(let t=0,n=s.length;t<n;t++)e[s[t]].isBone=!0}for(let t=0,s=e.length;t<s;t++){const s=e[t];void 0!==s.mesh&&(this._addNodeRef(this.meshCache,s.mesh),void 0!==s.skin&&(n[s.mesh].isSkinnedMesh=!0)),void 0!==s.camera&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const s=n.clone(),r=(e,t)=>{const n=this.associations.get(e);null!=n&&this.associations.set(t,n);for(const[n,s]of e.children.entries())r(s,t.children[n])};return r(n,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const s=e(t[n]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let s=0;s<t.length;s++){const r=e(t[s]);r&&n.push(r)}return n}getDependency(e,t){const n=e+":"+t;let s=this.cache.get(n);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":s=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":s=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne((function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)})),!s)throw new Error("Unknown type: "+e)}this.cache.add(n,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,s=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(s.map((function(t,s){return n.getDependency(e,s)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[we.KHR_BINARY_GLTF].body);const s=this.options;return new Promise((function(e,r){n.load(a.resolveURL(t.uri,s.path),e,void 0,(function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const n=t.byteLength||0,s=t.byteOffset||0;return e.slice(s,s+n)}))}loadAccessor(e){const t=this,n=this.json,s=this.json.accessors[e];if(void 0===s.bufferView&&void 0===s.sparse){const e=Qe[s.type],t=qe[s.componentType],n=!0===s.normalized,r=new t(s.count*e);return Promise.resolve(new y(r,e,n))}const r=[];return void 0!==s.bufferView?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),void 0!==s.sparse&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then((function(e){const r=e[0],o=Qe[s.type],i=qe[s.componentType],a=i.BYTES_PER_ELEMENT,c=a*o,l=s.byteOffset||0,u=void 0!==s.bufferView?n.bufferViews[s.bufferView].byteStride:void 0,h=!0===s.normalized;let d,p;if(u&&u!==c){const e=Math.floor(l/u),n="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+e+":"+s.count;let c=t.cache.get(n);c||(d=new i(r,e*u,s.count*u/a),c=new _(d,u/a),t.cache.add(n,c)),p=new M(c,o,l%u/a,h)}else d=null===r?new i(s.count*o):new i(r,l,s.count*o),p=new y(d,o,h);if(void 0!==s.sparse){const t=Qe.SCALAR,n=qe[s.sparse.indices.componentType],a=s.sparse.indices.byteOffset||0,c=s.sparse.values.byteOffset||0,l=new n(e[1],a,s.sparse.count*t),u=new i(e[2],c,s.sparse.count*o);null!==r&&(p=new y(p.array.slice(),p.itemSize,p.normalized));for(let e=0,t=l.length;e<t;e++){const t=l[e];if(p.setX(t,u[e*o]),o>=2&&p.setY(t,u[e*o+1]),o>=3&&p.setZ(t,u[e*o+2]),o>=4&&p.setW(t,u[e*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p}))}loadTexture(e){const t=this.json,n=this.options,s=t.textures[e].source,r=t.images[s];let o=this.textureLoader;if(r.uri){const e=n.manager.getHandler(r.uri);null!==e&&(o=e)}return this.loadTextureImage(e,s,o)}loadTextureImage(e,t,n){const s=this,r=this.json,o=r.textures[e],i=r.images[t],a=(i.uri||i.bufferView)+":"+o.sampler;if(this.textureCache[a])return this.textureCache[a];const c=this.loadImageSource(t,n).then((function(t){t.flipY=!1,t.name=o.name||i.name||"",""===t.name&&"string"==typeof i.uri&&!1===i.uri.startsWith("data:image/")&&(t.name=i.uri);const n=(r.samplers||{})[o.sampler]||{};return t.magFilter=We[n.magFilter]||L,t.minFilter=We[n.minFilter]||S,t.wrapS=Ye[n.wrapS]||b,t.wrapT=Ye[n.wrapT]||b,s.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[a]=c,c}loadImageSource(e,t){const n=this,s=this.json,r=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const o=s.images[e],i=self.URL||self.webkitURL;let c=o.uri||"",l=!1;if(void 0!==o.bufferView)c=n.getDependency("bufferView",o.bufferView).then((function(e){l=!0;const t=new Blob([e],{type:o.mimeType});return c=i.createObjectURL(t),c}));else if(void 0===o.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(c).then((function(e){return new Promise((function(n,s){let o=n;!0===t.isImageBitmapLoader&&(o=function(e){const t=new ie(e);t.needsUpdate=!0,n(t)}),t.load(a.resolveURL(e,r.path),o,void 0,s)}))})).then((function(e){var t;return!0===l&&i.revokeObjectURL(c),e.userData.mimeType=o.mimeType||((t=o.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),e}));return this.sourceCache[e]=u,u}assignTexture(e,t,n,s){const r=this;return this.getDependency("texture",n.index).then((function(o){if(!o)return null;if(void 0!==n.texCoord&&n.texCoord>0&&((o=o.clone()).channel=n.texCoord),r.extensions[we.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[we.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=r.associations.get(o);o=r.extensions[we.KHR_TEXTURE_TRANSFORM].extendTexture(o,e),r.associations.set(o,t)}}return void 0!==s&&(o.colorSpace=s),e[t]=o,o}))}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const s=void 0===t.attributes.tangent,r=void 0!==t.attributes.color,o=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new I,O.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new N,O.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,this.cache.add(e,t)),n=t}if(s||r||o){let e="ClonedMaterial:"+n.uuid+":";s&&(e+="derivative-tangents:"),r&&(e+="vertex-colors:"),o&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),r&&(t.vertexColors=!0),o&&(t.flatShading=!0),s&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}e.material=n}getMaterialType(){return H}loadMaterial(e){const t=this,n=this.json,s=this.extensions,r=n.materials[e];let o;const i={},a=[];if((r.extensions||{})[we.KHR_MATERIALS_UNLIT]){const e=s[we.KHR_MATERIALS_UNLIT];o=e.getMaterialType(),a.push(e.extendParams(i,r,t))}else{const n=r.pbrMetallicRoughness||{};if(i.color=new l(1,1,1),i.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;i.color.setRGB(e[0],e[1],e[2],u),i.opacity=e[3]}void 0!==n.baseColorTexture&&a.push(t.assignTexture(i,"map",n.baseColorTexture,f)),i.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,i.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(a.push(t.assignTexture(i,"metalnessMap",n.metallicRoughnessTexture)),a.push(t.assignTexture(i,"roughnessMap",n.metallicRoughnessTexture))),o=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),a.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,i)}))))}!0===r.doubleSided&&(i.side=C);const c=r.alphaMode||et;if(c===nt?(i.transparent=!0,i.depthWrite=!1):(i.transparent=!1,c===tt&&(i.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&o!==m&&(a.push(t.assignTexture(i,"normalMap",r.normalTexture)),i.normalScale=new A(1,1),void 0!==r.normalTexture.scale)){const e=r.normalTexture.scale;i.normalScale.set(e,e)}if(void 0!==r.occlusionTexture&&o!==m&&(a.push(t.assignTexture(i,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(i.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&o!==m){const e=r.emissiveFactor;i.emissive=(new l).setRGB(e[0],e[1],e[2],u)}return void 0!==r.emissiveTexture&&o!==m&&a.push(t.assignTexture(i,"emissiveMap",r.emissiveTexture,f)),Promise.all(a).then((function(){const n=new o(i);return r.name&&(n.name=r.name),rt(n,r),t.associations.set(n,{materials:e}),r.extensions&&st(s,n,r),n}))}createUniqueName(e){const t=P.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,s=this.primitiveCache;function r(e){return n[we.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return ht(n,e,t)}))}const o=[];for(let n=0,i=e.length;n<i;n++){const i=e[n],a=it(i),c=s[a];if(c)o.push(c.promise);else{let e;e=i.extensions&&i.extensions[we.KHR_DRACO_MESH_COMPRESSION]?r(i):ht(new k,i,t),s[a]={primitive:i,promise:e},o.push(e)}}return Promise.all(o)}loadMesh(e){const t=this,r=this.json,o=this.extensions,i=r.meshes[e],a=i.primitives,c=[];for(let e=0,t=a.length;e<t;e++){const t=void 0===a[e].material?(void 0===(l=this.cache).DefaultMaterial&&(l.DefaultMaterial=new H({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:oe})),l.DefaultMaterial):this.getDependency("material",a[e].material);c.push(t)}var l;return c.push(t.loadGeometries(a)),Promise.all(c).then((function(r){const c=r.slice(0,r.length-1),l=r[r.length-1],u=[];for(let r=0,h=l.length;r<h;r++){const h=l[r],d=a[r];let p;const m=c[r];if(d.mode===ze.TRIANGLES||d.mode===ze.TRIANGLE_STRIP||d.mode===ze.TRIANGLE_FAN||void 0===d.mode)p=!0===i.isSkinnedMesh?new D(h,m):new F(h,m),!0===p.isSkinnedMesh&&p.normalizeSkinWeights(),d.mode===ze.TRIANGLE_STRIP?p.geometry=ge(p.geometry,s):d.mode===ze.TRIANGLE_FAN&&(p.geometry=ge(p.geometry,n));else if(d.mode===ze.LINES)p=new U(h,m);else if(d.mode===ze.LINE_STRIP)p=new G(h,m);else if(d.mode===ze.LINE_LOOP)p=new B(h,m);else{if(d.mode!==ze.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);p=new j(h,m)}Object.keys(p.geometry.morphAttributes).length>0&&ot(p,i),p.name=t.createUniqueName(i.name||"mesh_"+e),rt(p,i),d.extensions&&st(o,p,d),t.assignFinalMaterial(p),u.push(p)}for(let n=0,s=u.length;n<s;n++)t.associations.set(u[n],{meshes:e,primitives:n});if(1===u.length)return i.extensions&&st(o,u[0],i),u[0];const h=new V;i.extensions&&st(o,h,i),t.associations.set(h,{meshes:e});for(let e=0,t=u.length;e<t;e++)h.add(u[e]);return h}))}loadCamera(e){let t;const n=this.json.cameras[e],s=n[n.type];if(s)return"perspective"===n.type?t=new K(X.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):"orthographic"===n.type&&(t=new z(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),rt(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n=[];for(let e=0,s=t.joints.length;e<s;e++)n.push(this._loadNodeShallow(t.joints[e]));return void 0!==t.inverseBindMatrices?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then((function(e){const n=e.pop(),s=e,r=[],i=[];for(let e=0,a=s.length;e<a;e++){const a=s[e];if(a){r.push(a);const t=new o;null!==n&&t.fromArray(n.array,16*e),i.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}return new q(r,i)}))}loadAnimation(e){const t=this.json,n=this,s=t.animations[e],r=s.name?s.name:"animation_"+e,o=[],i=[],a=[],c=[],l=[];for(let e=0,t=s.channels.length;e<t;e++){const t=s.channels[e],n=s.samplers[t.sampler],r=t.target,u=r.node,h=void 0!==s.parameters?s.parameters[n.input]:n.input,d=void 0!==s.parameters?s.parameters[n.output]:n.output;void 0!==r.node&&(o.push(this.getDependency("node",u)),i.push(this.getDependency("accessor",h)),a.push(this.getDependency("accessor",d)),c.push(n),l.push(r))}return Promise.all([Promise.all(o),Promise.all(i),Promise.all(a),Promise.all(c),Promise.all(l)]).then((function(e){const t=e[0],s=e[1],o=e[2],i=e[3],a=e[4],c=[];for(let e=0,r=t.length;e<r;e++){const r=t[e],l=s[e],u=o[e],h=i[e],d=a[e];if(void 0===r)continue;r.updateMatrix&&r.updateMatrix();const p=n._createAnimationTracks(r,l,u,h,d);if(p)for(let e=0;e<p.length;e++)c.push(p[e])}return new W(r,void 0,c)}))}createNodeMesh(e){const t=this.json,n=this,s=t.nodes[e];return void 0===s.mesh?null:n.getDependency("mesh",s.mesh).then((function(e){const t=n._getNodeRef(n.meshCache,s.mesh,e);return void 0!==s.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,n=s.weights.length;t<n;t++)e.morphTargetInfluences[t]=s.weights[t]})),t}))}loadNode(e){const t=this,n=this.json.nodes[e],s=t._loadNodeShallow(e),r=[],o=n.children||[];for(let e=0,n=o.length;e<n;e++)r.push(t.getDependency("node",o[e]));const i=void 0===n.skin?Promise.resolve(null):t.getDependency("skin",n.skin);return Promise.all([s,Promise.all(r),i]).then((function(e){const t=e[0],n=e[1],s=e[2];null!==s&&t.traverse((function(e){e.isSkinnedMesh&&e.bind(s,lt)}));for(let e=0,s=n.length;e<s;e++)t.add(n[e]);return t}))}_loadNodeShallow(e){const t=this.json,n=this.extensions,s=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const r=t.nodes[e],i=r.name?s.createUniqueName(r.name):"",a=[],c=s._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return c&&a.push(c),void 0!==r.camera&&a.push(s.getDependency("camera",r.camera).then((function(e){return s._getNodeRef(s.cameraCache,r.camera,e)}))),s._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){a.push(e)})),this.nodeCache[e]=Promise.all(a).then((function(t){let a;if(a=!0===r.isBone?new Y:t.length>1?new V:1===t.length?t[0]:new R,a!==t[0])for(let e=0,n=t.length;e<n;e++)a.add(t[e]);if(r.name&&(a.userData.name=r.name,a.name=i),rt(a,r),r.extensions&&st(n,a,r),void 0!==r.matrix){const e=new o;e.fromArray(r.matrix),a.applyMatrix4(e)}else void 0!==r.translation&&a.position.fromArray(r.translation),void 0!==r.rotation&&a.quaternion.fromArray(r.rotation),void 0!==r.scale&&a.scale.fromArray(r.scale);return s.associations.has(a)||s.associations.set(a,{}),s.associations.get(a).nodes=e,a})),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],s=this,r=new V;n.name&&(r.name=s.createUniqueName(n.name)),rt(r,n),n.extensions&&st(t,r,n);const o=n.nodes||[],i=[];for(let e=0,t=o.length;e<t;e++)i.push(s.getDependency("node",o[e]));return Promise.all(i).then((function(e){for(let t=0,n=e.length;t<n;t++)r.add(e[t]);return s.associations=(e=>{const t=new Map;for(const[e,n]of s.associations)(e instanceof O||e instanceof ie)&&t.set(e,n);return e.traverse((e=>{const n=s.associations.get(e);null!=n&&t.set(e,n)})),t})(r),r}))}_createAnimationTracks(e,t,n,s,r){const o=[],i=e.name?e.name:e.uuid,a=[];let c;switch($e[r.path]===$e.weights?e.traverse((function(e){e.morphTargetInfluences&&a.push(e.name?e.name:e.uuid)})):a.push(i),$e[r.path]){case $e.weights:c=ce;break;case $e.rotation:c=le;break;case $e.position:case $e.scale:c=ae;break;default:if(1===n.itemSize)c=ce;else c=ae}const l=void 0!==s.interpolation?Je[s.interpolation]:Q,u=this._getArrayFromAccessor(n);for(let e=0,n=a.length;e<n;e++){const n=new c(a[e]+"."+$e[r.path],t.array,u,l);"CUBICSPLINE"===s.interpolation&&this._createCubicSplineTrackInterpolant(n),o.push(n)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=ct(t.constructor),n=new Float32Array(t.length);for(let s=0,r=t.length;s<r;s++)n[s]=t[s]*e;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof le?Xe:Ve)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function ht(e,t,n){const s=t.attributes,r=[];function o(t,s){return n.getDependency("accessor",t).then((function(t){e.setAttribute(s,t)}))}for(const t in s){const n=Ze[t]||t.toLowerCase();n in e.attributes||r.push(o(s[t],n))}if(void 0!==t.indices&&!e.index){const s=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));r.push(s)}return Z.workingColorSpace!==u&&"COLOR_0"in s&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Z.workingColorSpace}" not supported.`),rt(e,t),function(e,t,n){const s=t.attributes,r=new ue;if(void 0===s.POSITION)return;{const e=n.json.accessors[s.POSITION],t=e.min,o=e.max;if(void 0===t||void 0===o)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(r.set(new T(t[0],t[1],t[2]),new T(o[0],o[1],o[2])),e.normalized){const t=ct(qe[e.componentType]);r.min.multiplyScalar(t),r.max.multiplyScalar(t)}}const o=t.targets;if(void 0!==o){const e=new T,t=new T;for(let s=0,r=o.length;s<r;s++){const r=o[s];if(void 0!==r.POSITION){const s=n.json.accessors[r.POSITION],o=s.min,i=s.max;if(void 0!==o&&void 0!==i){if(t.setX(Math.max(Math.abs(o[0]),Math.abs(i[0]))),t.setY(Math.max(Math.abs(o[1]),Math.abs(i[1]))),t.setZ(Math.max(Math.abs(o[2]),Math.abs(i[2]))),s.normalized){const e=ct(qe[s.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(e)}e.boundingBox=r;const i=new he;r.getCenter(i.center),i.radius=r.min.distanceTo(r.max)/2,e.boundingSphere=i}(e,t,n),Promise.all(r).then((function(){return void 0!==t.targets?function(e,t,n){let s=!1,r=!1,o=!1;for(let e=0,n=t.length;e<n;e++){const n=t[e];if(void 0!==n.POSITION&&(s=!0),void 0!==n.NORMAL&&(r=!0),void 0!==n.COLOR_0&&(o=!0),s&&r&&o)break}if(!s&&!r&&!o)return Promise.resolve(e);const i=[],a=[],c=[];for(let l=0,u=t.length;l<u;l++){const u=t[l];if(s){const t=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):e.attributes.position;i.push(t)}if(r){const t=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):e.attributes.normal;a.push(t)}if(o){const t=void 0!==u.COLOR_0?n.getDependency("accessor",u.COLOR_0):e.attributes.color;c.push(t)}}return Promise.all([Promise.all(i),Promise.all(a),Promise.all(c)]).then((function(t){const n=t[0],i=t[1],a=t[2];return s&&(e.morphAttributes.position=n),r&&(e.morphAttributes.normal=i),o&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}function dt({radius:t,object3d:n}){const s=function(t){const n=Math.random(),s=Math.random(),r=Math.acos(2*s-1),o=2*Math.PI*n,i=t*Math.sin(r)*Math.cos(o),a=t*Math.sin(r)*Math.sin(o),c=t*Math.cos(r);return new e.Vector3(i,a,c)}(t),r=(new e.Matrix4).makeTranslation(s.x,s.y,s.z),o=s.normalize(),i=new e.Vector3(0,1,0).normalize();var a=(new e.Quaternion).setFromUnitVectors(i,o);const c=(new e.Matrix4).makeRotationFromQuaternion(a);r.multiply(c);var l=new e.Vector3,u=(a=new e.Quaternion,new e.Vector3(5,5,5));r.decompose(l,a,u),n.position.copy(l),n.quaternion.copy(a),n.scale.copy(u)}function pt(e,t){var n=e+t;return(n%=360)<0&&(n+=360),n}function mt(e,t){var n=t-e;return(n=(n+360)%360)>180&&(n-=360),n}new e.Vector3(0,0,1);const ft=[0,0,14];function gt(){const t=new e.WebGLRenderer;document.body.appendChild(t.domElement);const n=function(t){const n=t.clientWidth/t.clientHeight,s=new e.PerspectiveCamera(60,n,.1,100);return s.position.set(...ft),window.camera=s,window.THREE=e,s}(t.domElement);function s(){n.aspect=window.innerWidth/window.innerHeight,n.updateProjectionMatrix(),t.setSize(window.innerWidth,window.innerHeight)}return window.addEventListener("resize",s,!1),s(),{renderer:t,camera:n}}function At(e,t){e.position.set(t.position.x,t.position.y,t.position.z)}(()=>{const t=new e.Vector3(0,0,-1);new e.Plane(t,0)})();const Tt=function(t=10){const n=new e.SphereGeometry(t,32,32),s=new e.MeshPhongMaterial({color:2365716});return new e.Mesh(n,s)}();function wt(){if("undefined"!=typeof screen&&screen?.orientation?.type)return screen.orientation.type;if(void 0!==window.orientation){if(0===window.orientation)return"portrait-primary";if(180===window.orientation)return"portrait-secondary";if(90===window.orientation)return"landscape-primary";if(-90===window.orientation||270===window.orientation)return"landscape-secondary"}}new pe,new me,Math.cos(70*X.DEG2RAD),new o,new o,new fe,new T,new o,new o,new T,"undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission&&DeviceOrientationEvent.requestPermission().then((()=>{console.log("got access")}),(()=>{console.log("rejected access");const e=function(){const e=document.createElement("button");return e.innerHTML="enable device orientation",Object.assign(e.style,{position:"fixed",left:"0px",top:"0px",width:"100vw",fontSize:"5vh"}),e}();document.body.append(e),e.onclick=function(){DeviceOrientationEvent.requestPermission().then((()=>{e.remove()}),(()=>{}))}}));let xt,Rt=!0,Et=null;function vt(e){return Math.abs(mt(e,0))<5}var yt;yt=function(){Et=null},window?.screen?.orientation?.addEventListener?window.screen.orientation.addEventListener("change",yt):window.addEventListener("orientationchange",yt);const _t=[];function Mt(e){return St(e,new THREE.Vector3(0,1,0))}function Lt(e,t=wt()){return St(e,"portrait-primary"===t?new THREE.Vector3(0,0,-1):"portrait-secondary"===t?new THREE.Vector3(0,0,1):"landscape-primary"===t?new THREE.Vector3(1,0,0):"landscape-secondary"===t?new THREE.Vector3(-1,0,0):new THREE.Vector3(0,0,-1))}function St(e,t){let{alpha:n,beta:s,gamma:r,absolute:o}=e;n=THREE.MathUtils.degToRad(n),s=THREE.MathUtils.degToRad(s),r=THREE.MathUtils.degToRad(-r);var i=new THREE.Euler(s,n,r,"YXZ");return t.applyEuler(i)}function bt(t){var n=new e.Vector3;return t.getWorldDirection(n),n}function It(t){return(new e.Vector3).crossVectors(t.up,bt(t)).normalize()}window.addEventListener("deviceorientation",(function(e){xt||(xt=e,function({alpha:e,gamma:t,beta:n},s=wt()){return console.log("nearZero",e,vt(e),n,vt(n),t,vt(t)),vt(e)&&vt(t)&&vt(n)}(e)&&(Rt=!1)),null===Et&&(Et=e),wt();const t={sourceOrientationEvent:e,firstDeviceOrientation:xt,screenOrientation:wt(),deviceOrientationAtLastScreenOrientation:Et,isOrientationRelativeToGravity:Rt};let n;n=Rt?{alpha:e.alpha,beta:e.beta,gamma:e.gamma}:function(e,t,n=wt()){return"landscape-primary"===n?{alpha:pt(mt(e.alpha,t.alpha),90),beta:mt(e.beta,t.beta),gamma:mt(mt(e.gamma,t.gamma),90)}:"portrait-primary"===n?{alpha:mt(e.alpha,t.alpha),beta:pt(mt(e.beta,t.beta),90),gamma:mt(e.gamma,t.gamma)}:void 0}(e,Et),Object.assign(t,{adjustedOrientation:n,z:Mt(n),userTopDirection:Lt(n)}),_t.forEach((e=>e(t)))}));const Ot=new Promise(((e,t)=>{var n,s,r;n=t=>{e(t.scene)},s=()=>{},r=e=>{t(e)},(new Ae).load("./objects/flower/flower-top.glb",n,s,r)})).then((e=>({init_flower({position:t=[0,0,0]}={}){const n=new THREE.Group,s=e.clone(),r=(new THREE.Box3).setFromObject(s),o=new THREE.Sphere;r.getBoundingSphere(o);const i=new THREE.MeshBasicMaterial({color:65280,wireframe:!0,transparent:!0,opacity:0}),a=new THREE.Mesh(new THREE.SphereGeometry(o.radius,32,32),i);return a.position.copy(o.center),n.add(a),n.add(s),n.scale.set(4,4,4),dt({radius:10,object3d:n}),n},animate_flower(e,t){t.intersectObjects(e.children).length&&e.scale.addScalar(.01)}})));function Nt({w:t=1,h:n=1,d:s=1,x:r=0,y:o=0,z:i=0,color:a=15658734}){const c=new e.BoxGeometry(t,n,s),l=new e.Mesh(c,new e.MeshPhongMaterial({color:a}));return l.position.x=r,l.position.y=o,l.position.z=i,l}function Ht(t,n){const s=new e.GridHelper(25,25);s.rotation.x=Math.PI/2,s.position.x=0,s.position.y=0,s.position.z=0,t.add(s);const r=new e.GridHelper(25,25);r.position.x=0,r.position.y=0,r.position.z=0,t.add(r),t.add(Nt({x:5,y:5,color:16744576})),t.add(Nt({x:5,y:-5,color:8388608})),t.add(Nt({x:-5,y:5,color:8421631})),t.add(Nt({x:-5,y:-5,color:128})),t.add(Nt({x:0,y:0,color:16777215}));var o=new e.AxesHelper(1);t.add(o);const i=new e.ArrowHelper(new e.Vector3(1,0,0),new e.Vector3(0,0,0),5,16776960);t.add(i);const a=document.createElement("div");let c;document.body.append(a),Object.assign(a.style,{position:"fixed",right:"0px",top:"0px",fontSize:"2vh",color:"white"}),function(e){_t.push(e)}((e=>{c=e;const{adjustedOrientation:t,sourceOrientationEvent:n,deviceOrientationAtLastScreenOrientation:s,screenOrientation:r,z:o,isOrientationRelativeToGravity:i}=e,l=n,u=s,h=u?.alpha||0,d=Math.round(t.alpha),p=u?.beta||0,m=Math.round(t.beta);a.innerHTML=`\n            <pre style="margin: 0px">alpha (.) ${Math.round(l.alpha)} - ${Math.round(h)} = ${d}</pre>\n            <pre style="margin: 0px">beta  (-) ${Math.round(l.beta)}  - ${Math.round(p)} = ${m}</pre>\n            <pre style="margin: 0px">gamma (|) ${Math.round(l.gamma)} - ${Math.round(u.gamma)} =${Math.round(t.gamma)} </pre>\n            <pre style="margin: 0px">${wt()} ${i?"":""}</p>\n        `}));let l=!1;return window.addEventListener("keydown",(function(e){l=!0})),{animate(){var t=new e.Vector3;n.getWorldDirection(t);const s=(new e.Vector3).crossVectors(n.up,t).normalize(),r=s.clone().negate(),a=t.clone().multiplyScalar(3).add(n.up).add(s);l&&(console.log({directionAndLeft:Ct(t,s),directionAndUp:Ct(t,n.up.clone()),upAndLeft:Ct(s,n.up.clone()),pos:n.position.clone(),up:n.up.clone(),direction:t.clone(),left:s.clone(),movement:a}),l=!1),o.position.copy(n.position).add(t.multiplyScalar(3)).add(n.up).add(s),c&&(i.position.copy(n.position).add(t.multiplyScalar(3)).add(n.up).add(r),console.log(i.position),i.setDirection(c.userTopDirection))}}}function Ct(e,t){var n=e.dot(t);return Math.abs(n)<Number.EPSILON}!function(){const{renderer:t,camera:n}=gt(),s=new e.Scene,r=Ht(s,n),o=function(t,n,s){return window.onkeydown=function(n){if("Digit0"===n.code?n.shiftKey?(t.position.set(0,0,-20),t.rotation.x=0,t.rotation.y=0,t.rotation.z=0,t.lookAt(new e.Vector3(0,0,0))):(t.position.set(0,0,20),t.rotation.x=0,t.rotation.y=0,t.rotation.z=0,t.lookAt(new e.Vector3(0,0,0))):"Digit1"===n.code?(t.position.set(0,0,0),t.rotation.x=0,t.rotation.y=0,t.rotation.z=0,t.lookAt(new e.Vector3(0,0,0)),t.rotateOnAxis(new e.Vector3(0,0,1),-Math.PI/4),t.translateY(-9),t.translateZ(2),t.rotateOnAxis(new e.Vector3(1,0,0),65*Math.PI/180)):"Space"===n.code&&(n.shiftKey?t.translateY(-.5):t.translateY(.5)),n.shiftKey){if("ArrowRight"===n.code&&t.rotateOnAxis(new e.Vector3(0,1,0),5*-Math.PI/180),"ArrowLeft"===n.code&&t.rotateOnAxis(new e.Vector3(0,1,0),5*Math.PI/180),"ArrowUp"===n.code){const n=It(t);t.rotateOnAxis(new e.Vector3(1,0,0),5*Math.PI/180);var s=(new e.Vector3).crossVectors(bt(t),n);t.up.copy(s)}if("ArrowDown"===n.code){const n=It(t);t.rotateOnAxis(new e.Vector3(1,0,0),5*-Math.PI/180),s=(new e.Vector3).crossVectors(bt(t),n),t.up.copy(s)}}else"ArrowRight"===n.code&&t.translateX(.5),"ArrowLeft"===n.code&&t.translateX(-.5),"ArrowUp"===n.code&&t.translateZ(-.5),"ArrowDown"===n.code&&t.translateZ(.5)},{update(){}}}(n),i=function(t,n){const s=new e.Vector2;return t.addEventListener("pointermove",(function(e){s.x=e.clientX/window.innerWidth*2-1,s.y=-e.clientY/window.innerHeight*2+1,n&&n({mouse:s,event:e})}),!1),t.style="touch-action: none",function(){return s}}(t.domElement,(function({event:t}){c=!0;const s=new e.Raycaster;s.setFromCamera(i(),n),function(t,n){new e.Vector3;const s=n.intersectObject(Tt);s.length&&t.target.position.copy(s[0].point)}(a,s)})),a=function(t){const n=new e.SpotLight(16777215,200);return n.angle=Math.PI/25,n.penumbra=.3,n.target.position.set(0,0,0),n}();At(a,n),s.add(a,a.target,new e.AmbientLight(3684408,20));let c=!1;t.render(s,n),Promise.all([Ot]).then((([{init_flower:l,animate_flower:u}])=>{const h=[];for(let e=0;e<10;e++){const e=l({position:[5-10*Math.random(),5-10*Math.random(),0]});s.add(e),h.push(e)}function d(l){const p=new e.Raycaster;if(p.setFromCamera(i(),n),l*=.001,o.update(),c)for(const e of h)u(e,p);r.animate(),function({time:e,mouse:r}){At(a,n),t.render(s,n),requestAnimationFrame(d)}(l)}requestAnimationFrame(d)}))}();
//# sourceMappingURL=production.js.map
